<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome Web Highlighter - Test Page</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #333;
        }
        
        .code-block {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        
        .debug-panel {
            position: fixed;
            right: 20px;
            top: 20px;
            width: 300px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .debug-panel h3 {
            margin-top: 0;
        }
        
        .debug-stats {
            font-family: monospace;
            font-size: 12px;
        }
        
        .debug-button {
            margin: 5px 0;
            padding: 5px 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .debug-button:hover {
            background: #0056b3;
        }
        
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .error-test {
            background: #fee;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Chrome Web Highlighter Test Page</h1>
    
    <div class="test-section">
        <h2>Basic Text Selection Test</h2>
        <p>This is a simple paragraph that you can use to test basic text highlighting. Select any portion of this text and the highlight button should appear. After highlighting, reload the page to test persistence.</p>
        <p>Here's another paragraph with <strong>bold text</strong>, <em>italic text</em>, and <u>underlined text</u> to test highlighting across different text styles.</p>
    </div>
    
    <div class="test-section">
        <h2>Complex DOM Structure Test</h2>
        <p>This section tests highlighting in more complex structures:</p>
        <ul>
            <li>List item 1 - select text here</li>
            <li>List item 2 with <strong>nested <em>formatting</em></strong></li>
            <li>List item 3 with a <a href="#">link inside</a></li>
        </ul>
        <blockquote>
            This is a blockquote that contains multiple lines of text.
            It's useful for testing how highlights work across block elements.
        </blockquote>
    </div>
    
    <div class="test-section">
        <h2>Input Field Interaction Test</h2>
        <p>The highlighter should not interfere with form inputs:</p>
        <input type="text" placeholder="Type here - highlighting should not activate">
        <textarea rows="3" placeholder="Multi-line text input - test selection here"></textarea>
        <div contenteditable="true" style="border: 1px solid #ccc; padding: 10px; min-height: 60px;">
            This is a contenteditable div. Selection here should not trigger highlighting.
        </div>
    </div>
    
    <div class="test-section">
        <h2>Error Scenario Tests</h2>
        <div class="error-test">
            <p><strong>Test 1: Extension Reload</strong></p>
            <ol>
                <li>Create some highlights on this page</li>
                <li>Go to chrome://extensions/</li>
                <li>Click "Reload" on the extension</li>
                <li>Come back to this page</li>
                <li>Try to create new highlights</li>
                <li>Check console for error handling</li>
            </ol>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Code Example Test</h2>
        <div class="code-block">
            // Test highlighting in code blocks
            function testHighlighter() {
                const text = "This is code that can be highlighted";
                console.log(text);
                return true;
            }
        </div>
    </div>
    
    <!-- Debug Panel -->
    <div class="debug-panel">
        <h3>Debug Panel</h3>
        <div id="debug-stats" class="debug-stats">
            Loading debug info...
        </div>
        <div style="margin-top: 15px;">
            <button class="debug-button" onclick="updateDebugStats()">Refresh Stats</button>
            <button class="debug-button" onclick="testContextError()">Test Context Error</button>
            <button class="debug-button" onclick="clearAllHighlights()">Clear All Highlights</button>
            <button class="debug-button" onclick="showConsoleCommands()">Show Console Commands</button>
        </div>
    </div>
    
    <script>
        // Debug helper functions
        function updateDebugStats() {
            const statsEl = document.getElementById('debug-stats');
            
            if (window.__chromeHighlighterDebug) {
                const stats = window.__chromeHighlighterDebug.stats();
                statsEl.innerHTML = `
                    <strong>Extension State:</strong><br>
                    Initialized: ${stats.isInitialized}<br>
                    Context Valid: ${stats.contextValid}<br>
                    Orphaned: ${stats.isOrphaned}<br>
                    Error Count: ${stats.errorCount}<br>
                    Highlight Count: ${stats.highlightCount}<br>
                    Has UI: ${stats.hasUI}<br>
                    Highlights Loaded: ${stats.highlightsLoaded}<br>
                    <br>
                    <small>Last updated: ${new Date().toLocaleTimeString()}</small>
                `;
            } else {
                statsEl.innerHTML = 'Debug interface not available.<br>Make sure extension is loaded.';
            }
        }
        
        function testContextError() {
            if (window.__chromeHighlighterDebug) {
                window.__chromeHighlighterDebug.testError();
                console.log('Context error test triggered - check console');
            } else {
                alert('Debug interface not available');
            }
        }
        
        function clearAllHighlights() {
            // Send message to extension
            if (chrome && chrome.runtime) {
                chrome.runtime.sendMessage({action: 'removeAllHighlights'});
                console.log('Clear highlights message sent');
            } else {
                console.error('Chrome runtime not available');
            }
        }
        
        function showConsoleCommands() {
            console.log(`
Available console commands:

// Get current state
__chromeHighlighterDebug.stats()

// Test context error
__chromeHighlighterDebug.testError()

// Force orphan state
__chromeHighlighterDebug.forceOrphan()

// Reset error state
__chromeHighlighterDebug.resetState()

// Get full state object
__chromeHighlighterDebug.state()
            `);
            alert('Console commands printed to console');
        }
        
        // Auto-update stats every 2 seconds
        setInterval(updateDebugStats, 2000);
        
        // Initial update
        setTimeout(updateDebugStats, 1000);
        
        // Log when page loads
        console.log('Chrome Web Highlighter Test Page loaded');
        console.log('Debug interface will be available at: window.__chromeHighlighterDebug');
    </script>
</body>
</html>